{% extends 'movies/base.html' %}
{% load static %}

{% block content %}
<div class="container">
    <div class="section-header">
        <h2>My Watchlist</h2>
    </div>

    {% if movies %}
        <div class="movies-grid">
            {% for movie in movies %}
                <div class="movie-card">
                    {% with image_path="images/"|add:movie.title|lower|add:"_poster.jpg" %}
                        <img src="{% static image_path %}" alt="{{ movie.title }}" class="movie-poster" onerror="this.src='{% static 'images/default_poster.jpg' %}'">
                    {% endwith %}
                    <div class="movie-info">
                        <h2><a href="{% url 'movies:movie_detail' movie.id %}">{{ movie.title }}</a></h2>
                        <p class="year">({{ movie.release_year }})</p>
                        <div class="rating-container">
                            <span class="rating">‚≠ê {{ movie.imdb_rating }}/10</span>
                            <a href="{% url 'movies:movie_detail' movie.id %}#reviews" class="review-count">
                                <i class="fas fa-comment"></i> {{ movie.reviews_set.count }} reviews
                            </a>
                        </div>
                        {% if movie.genre %}
                            <p class="genre">{{ movie.genre }}</p>
                        {% endif %}
                        <form action="{% url 'movies:watchlist' %}" method="POST" class="remove-watchlist-form">
                            {% csrf_token %}
                            <input type="hidden" name="movie_id" value="{{ movie.id }}">
                            <button type="submit" name="remove" class="remove-watchlist-btn">
                                <i class="fas fa-trash"></i> Remove from Watchlist
                            </button>
                        </form>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="no-movies">Your watchlist is empty. Add some movies to get started!</p>
    {% endif %}
</div>
{% endblock %}